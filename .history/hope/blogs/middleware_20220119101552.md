# 中间件

## Redis

## Zookeeper

`zookeeper` 是一个分布式服务框架，是 `Apache Hadoop` 的一个子项目，它主要是用来解决分布式应用中经常遇到的一些数据管理问题，如：统一命名服务、状态同步服务、集群管理、分布式应用配置项的管理等。

* 结点类型：

  * 临时节点：临时节点的生命周期和客户端会话绑定在一起，客户端会话失效，则这个节点就会被自动清除。

  * 永久节点：该数据节点被创建后，就会一直存在于 `zookeeper` 服务器上，直到有删除操作来主动删除这个节点。

### 使用场景

配置中心：配置中心，顾名思义就是将配置数据写到 `ZK` 节点上，供各个分布式机器获取配置，同时监听自己对应的节点。实现配置信息的集中式管理和动态更新。

命名服务：在分布式系统中，通过使用命名服务，客户端应用能够根据指定名字来获取资源或服务的地址，提供者等信息。被命名的实体通常可以是集群中的机器，提供的服务地址，远程对象等等，这些我们都可以统称他们为名字(`Name`)。通过调用 `ZK` 提供的创建节点的 `API`，能够很容易创建一个全局唯一的 `path`，这个 `path` 就可以作为一个名称。

分布式通知：`ZooKeeper` 的 `watcher` 注册与异步通知机制，能够很好的实现分布式环境下不同系统之间的通知与协调，实现对数据变更的实时处理。不同系统都对 `ZK` 上同一个 `znode` 进行注册，监听 `znode` 的变化（包括 `znode` 本身内容及子节点的)，其中一个系统 `update` 了 `znode`，那么另一个系统能够收到通知，并作出相应处理

选主：利用 `ZooKeeper` 的一致性，能够保证在分布式高并发情况下节点创建的全局唯一性，即：同时有多个客户端请求创建 `/currentMaster` 节点，最终一定只有一个客户端请求能够创建成功。利用这个特性，就能很轻易的在分布式环境中进行集群选取了。

分布式锁：分布式锁，这个主要得益于 `ZooKeeper` 的节点创建和事件监听机制。

## Rabbit MQ

`Rabbit MQ` 是一个由 `erlang` 开发的 `AMQP（Advanced Message Queue）` 的开源实现

### 模块介绍

`Broker`：可以简单理解为一台物理机器。

`Producer`：消息生产者，就是投递消息的程序。

`Consumer`：消息消费者，就是接受消息的程序。

`Exchange`：消息交换机，它指定消息按什么规则，路由到哪个队列。
`fanout|direct|topic|headerQueue`：消息的载体，每个消息都会被投到一个或多个队列。

`Binding`：绑定，它的作用就是把 `exchange` 和 `queue` 按照路由规则绑定起来。

`Routing Key`：路由关键字，`exchange` 根据这个关键字进行消息投递。

`vhost`：虚拟主机，一个 `broker` 里可以有多个 `vhost`，用作不同用户的权限分离。

### 应用

消息传递、异步处理、应用解耦、流量削峰

### 高可用

发送方：`confirm` 机制（发送成功后有异步通知）

消费端：`ACK` 消息应答机制

`rabbit`：`queue` 持久化，消息持久化（`deliveryMode = 2`）

## Nginx

`Nginx` 是一款轻量级的 `Web` 服务器/反向代理服务器及电子邮件`（IMAP/POP3)`代理服务器，在 `BSD-like` 协议下发行。其特点是占有内存少，并发能力强，事实上 `nginx` 的并发能力在同类型的网页服务器中几乎成为公认的标杆，在百度、京东、新浪、网易、腾讯、淘宝等互联网公司中均有应用。

### 动静分离

静态资源：由 `nginx` 作为 `web` 服务器身份，直接返回

动态资源：`nginx` 将请求转发出去，交给后端应用服务器处理

### 负载均衡

当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群提升并行处理能力。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况。这时使用 `nginx` 实现了机器之间的负载均衡。
