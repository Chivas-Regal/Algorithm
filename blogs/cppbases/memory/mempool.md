---
title: 内存池
---

内存多次少量申请要用到非常多次 `malloc` ，十分占用性能，我们可以设计一种工具提高性能  
既然多次少量占用性能，我们少量多次分配内存，也就是在这个工具里面每次申请一大块内存，当别的封装好的类每次要 `new` 一个对象的时候，就从这个工具里面请求它申请好的内存中的一小块  
这样就减少了 `malloc` 的次数  
  
但是这只是申请的时候，那在析构的时候，这个对象的地址如果直接传回给工具内旧的内存块或者直接释放掉，前者是不好用到，后者在之后会重新使用一次 `malloc` ，什么意思呢
- 传回到旧的内存块，这样就使得这个工具内的每一个连续大内存块，都有部分是空闲的有部分是占用的，如果我们想用那些空闲部分则需要重新记录，就提高了这个工具内的空间复杂度
- 直接释放掉，明明这个地址还可以再拿来用，这里直接释放掉就有点浪费了

这里给出一种方法：在工具内定义一个链表，构造时在工具内申请空间的对象在析构时，把自己的地址用头插放在链表内  
这样在需要重新使用的时候可以用头取来获得一个空闲地址

## 成员变量

- 内存块（顺序）
  - 起始地址
  - 使用量
  - 最大可用量
- 释放进入的链表
  - 结构体（只有 `next`）
  - 首元素